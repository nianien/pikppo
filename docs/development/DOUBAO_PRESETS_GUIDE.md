# 豆包大模型版 API 预设配置详细说明

## 目录

1. [预设配置总览](#预设配置总览)
2. [核心参数详解](#核心参数详解)
3. [预设场景说明](#预设场景说明)
4. [参数调优指南](#参数调优指南)
5. [使用示例](#使用示例)
6. [A/B 对比建议](#ab-对比建议)

---

## 预设配置总览

### 完整配置表

| 预设名 | 资源 | model_version | VAD | end_window_size | punc | itn | ddc | show_utterances | speaker | 适用场景 |
|--------|------|---------------|-----|-----------------|------|-----|-----|-----------------|---------|----------|
| `default` | 1.0 | 400 | ❌ | - | ✅ | ✅ | ❌ | ✅ | ❌ | 通用转写 |
| `drama_v1` | 1.0 | 400 | ✅ | 800 | ❌ | ✅ | ❌ | ✅ | ❌ | **短剧主路（推荐）** |
| `drama_v2` | 2.0 | 400 | ✅ | 800 | ❌ | ✅ | ❌ | ✅ | ❌ | 短剧对照 |
| `drama_fast` | 1.0 | 400 | ✅ | 600 | ❌ | ✅ | ❌ | ✅ | ❌ | 更贴口型（更碎） |
| `drama_smooth` | 1.0 | 400 | ✅ | 1000 | ❌ | ✅ | ❌ | ✅ | ❌ | 更顺（更合并） |
| `transcript_semantic` | 1.0 | 400 | ❌ | - | ✅ | ✅ | ❌ | ✅ | ❌ | 语义分段转写（非字幕） |
| `drama_axis` | 1.0 | 400 | ✅ | 750 | ❌ | ✅ | ❌ | ✅ | ❌ | 字幕工程专用（强制可重打轴） |
| `drama_spk_v2` | 2.0 | 400 | ✅ | 800 | ❌ | ✅ | ❌ | ✅ | ✅ | 需要说话人分离 |

### 快速选择指南

- **短剧字幕工程（推荐）**: `drama_v1` 或 `drama_axis`
- **需要说话人分离**: `drama_spk_v2`
- **模型效果对比**: `drama_v1` vs `drama_v2`
- **颗粒度调优**: `drama_fast` (600ms) → `drama_v1` (800ms) → `drama_smooth` (1000ms)
- **通用转写**: `default`
- **摘要/脚本生成**: `transcript_semantic`

---

## 核心参数详解

### 1. 资源 ID (resource_id)

**作用**: 选择使用的 ASR 模型版本

**可选值**:
- `volc.bigasr.auc`: 模型 1.0（更保守，适合自动链路主结果）
- `volc.seedasr.auc`: 模型 2.0（更强的说话人分离/上下文理解）

**选择建议**:
- **模型 1.0**: 短剧主路，更稳定，时间轴更准确
- **模型 2.0**: 需要说话人分离时，或作为对照测试

**注意**: 模型 2.0 在转场/BGM 边缘可能"顺一句"，需要谨慎使用。

---

### 2. 模型版本 (model_version)

**作用**: 指定模型的具体版本号

**当前值**: `"400"`（所有预设统一写死）

**为什么写死**:
- 保证可复现性：不同时间运行结果一致
- 避免版本差异：防止"你以为在对比策略，实际在对比模型版本"
- 统一基准：所有预设使用相同的模型版本，便于 A/B 对比

**建议**: 所有预设统一使用 `"400"`，除非有特殊需求。

---

### 3. VAD 切句 (vad_segment)

**作用**: 是否使用 VAD（Voice Activity Detection）进行切句

**可选值**:
- `true`: 按声音停顿切句，更贴时间轴
- `false`: 语义切句，可能合并句子

**选择建议**:

✅ **短剧字幕场景（推荐开）**:
- 更贴时间轴：按声音停顿切，而不是语义
- 避免语义合并：短剧最怕"语义合并导致轴粒度丢失"
- 可重打轴：拿到更准确的时间戳原料

❌ **语义分段转写（推荐关）**:
- 适合摘要/脚本生成
- 不适合打轴字幕

**影响**:
- `vad_segment=true`: 句子更碎，但时间轴更准确
- `vad_segment=false`: 句子更完整，但可能合并导致时间轴不准确

---

### 4. 静音判停时间 (end_window_size)

**作用**: 控制多长静音算"结束"（仅在 `vad_segment=true` 时生效）

**可选值**: `300-5000` 毫秒

**常用值**:
- `600ms`: 更碎，更贴口型，字幕条数多（可能像"逐字跳动"）
- `750ms`: 平衡颗粒度（字幕工程专用）
- `800ms`: 比较平衡（短剧常用，推荐起点）
- `1000ms`: 更不碎，合并更多句子（更像"配音稿"）

**调优建议**:

针对同一集短剧，建议做 3 档扫参：

```bash
# 600ms：更碎，更贴口型
python test/test_doubao_asr.py --llm <URL> --preset drama_fast

# 800ms：平衡（推荐起点）
python test/test_doubao_asr.py --llm <URL> --preset drama_v1

# 1000ms：更不碎
python test/test_doubao_asr.py --llm <URL> --preset drama_smooth
```

**选择依据**:
- 语速快/对白密 → 600ms
- 语速中等 → 800ms（推荐）
- 语速慢/对白稀 → 1000ms

**注意**: `drama_fast` (600ms) 可能产生很多短句，建议配套"合并后处理器"（例如：相邻两条间隔<120ms 且合并后不超 14 字则合并）。

---

### 5. 标点符号 (use_punc)

**作用**: 是否在识别结果中增加标点符号

**可选值**:
- `true`: 增加标点
- `false`: 不增加标点

**选择建议**:

❌ **字幕工程场景（推荐关）**:
- 先对齐再补标点：减少模型插入标点造成的切句变化
- 后处理阶段自己补标点/断句
- 避免标点影响时间轴对齐

✅ **通用转写场景（推荐开）**:
- 直接输出可读文本
- 适合摘要/脚本生成

**影响**:
- `use_punc=true`: 文本更完整，但可能影响切句
- `use_punc=false`: 文本无标点，但切句更稳定

---

### 6. 文本规范化 (use_itn)

**作用**: 将中文数字转为阿拉伯数字（如"一九七零年"→"1970年"）

**可选值**:
- `true`: 启用 ITN（推荐）
- `false`: 不启用

**选择建议**:

✅ **推荐开启**:
- 可读性更好：数字更直观
- 标准化：统一数字格式

⚠️ **注意事项**:
- 如果后面做"按字符比例分配时间"的方案，ITN 会让字符长度变化，可能受影响
- 如果用的是 word/utterance 时间戳，则没问题，放心开

**当前所有预设**: 统一使用 `true`

---

### 7. 语义顺滑 (use_ddc)

**作用**: 删除停顿词、语气词、重复词等（语义顺滑）

**可选值**:
- `true`: 启用顺滑
- `false`: 不启用（推荐）

**选择建议**:

❌ **短剧字幕场景（强烈建议关闭）**:
- 避免改写原话：顺滑会删口头禅、重复词、语气词
- 时间轴对不上：字被删了，导致对齐困难
- 文本变"更像改写"：难对齐，失去原意

**为什么短剧要关**:
- 短剧对白里这些"水词"往往是情绪和节奏的一部分
- 删除后会导致时间轴对不上
- 影响口型对齐

**当前所有预设**: 统一使用 `false`

---

### 8. 输出详细信息 (show_utterances)

**作用**: 输出语音停顿、分句、分词信息（包含时间戳）

**可选值**:
- `true`: 输出详细信息（**必须开**）
- `false`: 不输出

**选择建议**:

✅ **所有场景（强烈建议开启）**:
- 必须开，拿到可重打轴的信息
- 解决"Flash 合并句子"问题
- 即使通用转写也建议开，方便 debug

**为什么必须开**:
- 没有这个参数，你就只能做"按字符比例分配时间"的次优方案
- 有了这个参数，你可以自己切句、自己对齐口型
- 这是"可重打轴"的基础

**当前所有预设**: 统一使用 `true`

---

### 9. 说话人分离 (enable_speaker_info)

**作用**: 启用说话人聚类分离（识别不同说话人）

**可选值**:
- `true`: 启用说话人分离
- `false`: 不启用（默认）

**选择建议**:

❌ **短剧一般先别开（默认）**:
- 短剧往往有：远近变化、环境声、转场
- 会让 diarization 更不稳定
- 反而给你制造"错 speaker"的噪音

✅ **仅在需要时启用**:
- 对话很清晰的素材
- 需要区分不同人物时
- 使用 `drama_spk_v2` 预设

**注意事项**:
- 10 人以内效果较好
- 需要同时开 `vad_segment=true` 更合理
- 模型 2.0 的 speaker 效果更好

---

### 10. 语言 (language)

**作用**: 指定可识别的语言

**可选值**:
- `""`: 空字符串，自动识别（推荐）
- `"zh-CN"`: 中文
- `"en-US"`: 英语
- 其他语言代码...

**选择建议**:

- **短剧场景**: 使用 `"zh-CN"`（明确指定，避免误识别）
- **通用场景**: 使用 `""`（自动识别）

---

## 预设场景说明

### 1. default（通用转写）

**定位**: 通用场景的默认配置

**特点**:
- 模型 1.0，不开 VAD
- 开标点，适合直接阅读
- 开 ITN，数字规范化

**适用场景**:
- 通用音频转写
- 不需要精确时间轴的场景
- 快速获取文本内容

**不适用**:
- 短剧字幕工程（时间轴不准确）
- 需要精确对齐的场景

---

### 2. drama_v1（短剧主路）⭐ 推荐

**定位**: 短剧字幕工程的主路配置

**特点**:
- 模型 1.0，更稳定
- VAD 切句，800ms 静音判停
- 不开标点，不开顺滑
- 所有关键开关已补齐

**适用场景**:
- **短剧字幕工程（推荐）**
- 需要时间对齐
- 宁可碎一点，也不要合并

**参数选择理由**:
- `vad_segment=true`: 按声音停顿切，更贴时间轴
- `end_window_size=800`: 平衡的静音判停时间
- `use_punc=false`: 先不开，后处理补标点
- `use_ddc=false`: 不开顺滑，避免改写原话
- `show_utterances=true`: 必须开，拿时间戳

---

### 3. drama_v2（短剧对照）

**定位**: 与 `drama_v1` 对照，测试模型 2.0 的效果

**特点**:
- 模型 2.0，更强的上下文理解
- 参数与 `drama_v1` 完全一致（便于对比）
- 不开 speaker（需要时用 `drama_spk_v2`）

**适用场景**:
- 模型效果对比（1.0 vs 2.0）
- 需要更强上下文理解的场景

**注意事项**:
- 模型 2.0 在转场/BGM 边缘可能"顺一句"
- 建议先跑 `drama_v1`，再跑 `drama_v2` 对比

---

### 4. drama_fast（更贴口型）

**定位**: 更碎的切句，更贴口型

**特点**:
- `end_window_size=600ms`: 更短的静音判停
- 句子更碎，字幕条数多

**适用场景**:
- 语速快的短剧
- 对白密集的场景
- 需要更精确的口型对齐

**注意事项**:
- 预期：条数多，可能更像"逐字跳动"
- 建议配套"合并后处理器"（例如：相邻两条间隔<120ms 且合并后不超 14 字则合并）
- 否则观感会抖

---

### 5. drama_smooth（更顺）

**定位**: 更不碎的切句，合并更多句子

**特点**:
- `end_window_size=1000ms`: 更长的静音判停
- 句子更不碎，字幕条数更少

**适用场景**:
- 语速慢的短剧
- 对白稀疏的场景
- 更像"配音稿"的场景

**注意事项**:
- 定位：更像"配音稿"，而不是字幕
- 除非你后面一定会重切句，否则不建议用于字幕工程

---

### 6. transcript_semantic（语义分段转写）

**定位**: 语义切句，适合摘要/脚本生成

**特点**:
- `vad_segment=false`: 语义切句
- `use_punc=true`: 开标点
- 不开 VAD

**适用场景**:
- 摘要生成
- 脚本生成
- 不需要精确时间轴的转写

**不适用**:
- 短剧字幕工程（语义合并导致轴粒度丢失）
- 需要精确时间轴的场景

**注意**: 从 `drama_semantic` 改名，明确其"非字幕"定位。

---

### 7. drama_axis（字幕工程专用）⭐ 推荐

**定位**: 字幕工程专用，强制可重打轴

**特点**:
- `end_window_size=750ms`: 700~800ms 之间，平衡颗粒度
- 所有关键开关已优化
- 专门为"可重打轴"设计

**适用场景**:
- **字幕工程专用（推荐）**
- 需要最准确的时间戳原料
- 后续会重打轴的场景

**参数选择理由**:
- `show_utterances=true`: 强制开，拿到最准的时间戳原料
- `vad_segment=true`: VAD切句
- `end_window_size=750`: 平衡颗粒度（比 800ms 稍碎一点，但不会太碎）

**与 `drama_v1` 的区别**:
- `drama_v1`: 800ms，更平衡
- `drama_axis`: 750ms，稍碎一点，更适合字幕工程

---

### 8. drama_spk_v2（需要说话人分离）

**定位**: 仅在需要人物区分时启用

**特点**:
- 模型 2.0，speaker 效果更好
- `enable_speaker_info=true`: 启用说话人分离
- `vad_segment=true`: speaker 场景更需要 VAD 切

**适用场景**:
- 需要区分不同人物
- 对话很清晰的素材
- 多角色短剧

**注意事项**:
- 短剧一般先别开（默认用 `drama_v2`）
- 只在确实需要人物区分时使用
- 10 人以内效果较好
- 短剧往往有远近变化、环境声、转场，会让 diarization 更不稳定

**使用建议**:
- 先用 `drama_v2` 测试效果
- 如果确实需要 speaker，再使用 `drama_spk_v2`

---

## 参数调优指南

### 核心原则

**短剧字幕场景的核心原则**:
> 宁可碎一点，也不要合并；宁可少"顺滑"，也不要"改写"；要 word/utterance 级时间戳，轴你自己掌控。

### 调优流程

#### 1. 确定基础预设

**推荐起点**: `drama_v1` 或 `drama_axis`

```bash
# 先跑一次基础预设
python test/test_doubao_asr.py --llm <URL> --preset drama_v1
```

#### 2. 评估结果

检查以下指标：
- **字幕条数**: 是否合适？
- **平均时长**: 每条字幕的平均时长
- **对齐效果**: 时间轴是否准确？
- **碎不碎**: 是否太碎或太合并？

#### 3. 调整颗粒度

如果句子太碎 → 尝试 `drama_smooth` (1000ms)
```bash
python test/test_doubao_asr.py --llm <URL> --preset drama_smooth
```

如果句子太合并 → 尝试 `drama_fast` (600ms)
```bash
python test/test_doubao_asr.py --llm <URL> --preset drama_fast
```

#### 4. 模型对比

如果需要对比模型效果：
```bash
# 模型 1.0
python test/test_doubao_asr.py --llm <URL> --preset drama_v1

# 模型 2.0
python test/test_doubao_asr.py --llm <URL> --preset drama_v2
```

#### 5. 固定参数

找到甜点后，固定参数，全量跑。

### 参数调优对照表

| 问题 | 调整方向 | 推荐预设 |
|------|----------|----------|
| 句子太碎 | 增加 `end_window_size` | `drama_smooth` (1000ms) |
| 句子太合并 | 减少 `end_window_size` | `drama_fast` (600ms) |
| 时间轴不准确 | 开启 `vad_segment` | `drama_v1` / `drama_axis` |
| 需要说话人分离 | 使用模型 2.0 + speaker | `drama_spk_v2` |
| 需要更准确的时间戳 | 使用 `drama_axis` | `drama_axis` (750ms) |

---

## 使用示例

### 基本使用

```bash
# 使用默认预设（drama_v1）
python test/test_doubao_asr.py --llm https://your-bucket.com/audio.wav

# 使用指定预设
python test/test_doubao_asr.py --llm https://your-bucket.com/audio.wav --preset drama_axis

# 查询任务结果
python test/test_doubao_asr.py --llm --query <task_id>
```

### 3 档扫参（推荐）

针对同一集短剧，做 3 档扫参找到甜点：

```bash
# 600ms：更碎，更贴口型
python test/test_doubao_asr.py --llm <URL> --preset drama_fast

# 800ms：平衡（推荐起点）
python test/test_doubao_asr.py --llm <URL> --preset drama_v1

# 1000ms：更不碎
python test/test_doubao_asr.py --llm <URL> --preset drama_smooth
```

### 模型对比

```bash
# 模型 1.0（主路）
python test/test_doubao_asr.py --llm <URL> --preset drama_v1

# 模型 2.0（对照）
python test/test_doubao_asr.py --llm <URL> --preset drama_v2
```

### 字幕工程专用

```bash
# 字幕工程专用（强制可重打轴）
python test/test_doubao_asr.py --llm <URL> --preset drama_axis
```

---

## A/B 对比建议

### 对比指标

建议对比以下指标：

1. **字幕条数**: 总数和分布
2. **平均时长**: 每条字幕的平均时长
3. **静音出字率**: 静音段是否被识别为文字
4. **对齐抖动**: 时间轴的稳定性
5. **文本质量**: 识别准确率

### 对比方法

```bash
# 1. 使用不同预设跑同一音频
python test/test_doubao_asr.py --llm <URL> --preset drama_v1
python test/test_doubao_asr.py --llm <URL> --preset drama_v2

# 2. 对比生成的 SRT 文件
# - 条数对比
# - 时间轴对比
# - 文本质量对比
```

### 对比表格模板

| 预设 | 字幕条数 | 平均时长 | 对齐效果 | 文本质量 | 备注 |
|------|----------|----------|----------|----------|------|
| drama_v1 | 120 | 2.5s | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 推荐 |
| drama_v2 | 115 | 2.6s | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 文本更好但时间轴稍差 |
| drama_fast | 150 | 2.0s | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 太碎 |
| drama_smooth | 100 | 3.0s | ⭐⭐⭐ | ⭐⭐⭐⭐ | 太合并 |

---

## 常见问题

### Q1: 为什么所有预设都写死 `model_version="400"`？

**A**: 保证可复现性。如果不同预设使用不同版本，你无法确定是策略差异还是版本差异导致的结果不同。

### Q2: 为什么短剧场景要关闭 `use_ddc`？

**A**: 顺滑会删除口头禅、重复词、语气词，这些在短剧对白里往往是情绪和节奏的一部分。删除后会导致时间轴对不上，影响口型对齐。

### Q3: 为什么短剧场景要关闭 `use_punc`？

**A**: 先不开，减少模型插入标点造成的切句变化。后处理阶段自己补标点/断句，这样时间轴更稳定。

### Q4: `drama_fast` 和 `drama_smooth` 的区别？

**A**: 
- `drama_fast` (600ms): 更碎，更贴口型，但字幕条数多
- `drama_smooth` (1000ms): 更不碎，合并更多，但可能时间轴不准确

### Q5: 什么时候用 `drama_spk_v2`？

**A**: 仅在需要区分不同人物时使用。短剧一般先别开，因为短剧往往有远近变化、环境声、转场，会让 diarization 更不稳定。

### Q6: `drama_v1` 和 `drama_axis` 的区别？

**A**:
- `drama_v1`: 800ms，更平衡，适合大多数场景
- `drama_axis`: 750ms，稍碎一点，专门为"可重打轴"设计

---

## 总结

### 推荐配置

**短剧字幕工程（主路）**:
- `drama_v1`: 模型 1.0，800ms，平衡
- `drama_axis`: 模型 1.0，750ms，字幕工程专用

**需要说话人分离**:
- `drama_spk_v2`: 模型 2.0，开 speaker

**模型效果对比**:
- `drama_v1` vs `drama_v2`

**颗粒度调优**:
- `drama_fast` (600ms) → `drama_v1` (800ms) → `drama_smooth` (1000ms)

### 关键原则

1. **必须开**: `show_utterances=true`
2. **必须关**: `use_ddc=false`（短剧场景）
3. **建议关**: `use_punc=false`（字幕工程）
4. **建议开**: `use_itn=true`，`model_version="400"`
5. **短剧推荐**: `vad_segment=true`，`end_window_size=600~1000`

---

## 相关文档

- [豆包大模型版 API 请求参数说明](./DOUBAO_LLM_PARAMS.md)
- [预设配置文件](../src/video_remix/models/doubao_presets.yaml)
- [测试脚本](../../test/test_doubao_asr.py)
